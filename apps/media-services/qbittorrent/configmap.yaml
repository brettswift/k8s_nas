apiVersion: v1
kind: ConfigMap
metadata:
  name: qbittorrent-init-scripts
  namespace: qbittorrent
data:
  10-set-webui-rootfolder.sh: |
    #!/usr/bin/with-contenv bash
    CONFIG_FILE="/config/qBittorrent/qBittorrent.conf"
    
    echo "[qBittorrent Init] Setting WebUI RootFolder..."
    
    # Create config directory if it doesn't exist
    mkdir -p /config/qBittorrent
    
    # If config file exists, update it
    if [ -f "$CONFIG_FILE" ]; then
      echo "[qBittorrent Init] Config file found, removing RootFolder..."
      # Remove existing RootFolder - not needed when using rewrite-target in ingress
      # The ingress rewrite-target: / strips /qbittorrent, so qBittorrent receives requests at /
      sed -i '/WebUI\\RootFolder/d' "$CONFIG_FILE"
      echo "[qBittorrent Init] RootFolder removed (using ingress rewrite-target)"
    else
      echo "[qBittorrent Init] Config file not found yet, will be created on first run"
      # No RootFolder needed - ingress rewrite-target handles path transformation
    fi
