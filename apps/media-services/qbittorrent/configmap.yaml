apiVersion: v1
kind: ConfigMap
metadata:
  name: qbittorrent-init-scripts
  namespace: qbittorrent
data:
  10-set-webui-rootfolder.sh: |
    #!/usr/bin/with-contenv bash
    CONFIG_FILE="/config/qBittorrent/qBittorrent.conf"
    
    echo "[qBittorrent Init] Setting WebUI RootFolder..."
    
    # Create config directory if it doesn't exist
    mkdir -p /config/qBittorrent
    
    # If config file exists, update it
    if [ -f "$CONFIG_FILE" ]; then
      echo "[qBittorrent Init] Config file found, removing RootFolder..."
      # Remove RootFolder - not needed for subdomain routing (qbittorrent.home.brettswift.com)
      # Subdomain routing doesn't require path prefix, so no RootFolder needed
      sed -i '/WebUI\\RootFolder/d' "$CONFIG_FILE"
      echo "[qBittorrent Init] RootFolder removed (using subdomain routing)"
    else
      echo "[qBittorrent Init] Config file not found yet, will be created on first run"
      # No RootFolder needed for subdomain routing
    fi
