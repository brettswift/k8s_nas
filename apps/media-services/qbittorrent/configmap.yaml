apiVersion: v1
kind: ConfigMap
metadata:
  name: qbittorrent-init-scripts
  namespace: qbittorrent
data:
  10-set-webui-rootfolder.sh: |
    #!/usr/bin/with-contenv bash
    CONFIG_FILE="/config/qBittorrent/qBittorrent.conf"
    
    echo "[qBittorrent Init] Setting WebUI RootFolder..."
    
    # Create config directory if it doesn't exist
    mkdir -p /config/qBittorrent
    
    # If config file exists, update it
    if [ -f "$CONFIG_FILE" ]; then
      echo "[qBittorrent Init] Config file found, updating RootFolder..."
      # Remove existing RootFolder if present
      sed -i '/WebUI\\RootFolder/d' "$CONFIG_FILE"
      # Add RootFolder under [Preferences] section
      if grep -q "\[Preferences\]" "$CONFIG_FILE"; then
        sed -i '/\[Preferences\]/a WebUI\\RootFolder=/qbittorrent' "$CONFIG_FILE"
      else
        echo -e "\n[Preferences]\nWebUI\\RootFolder=/qbittorrent" >> "$CONFIG_FILE"
      fi
      echo "[qBittorrent Init] WebUI RootFolder set to /qbittorrent"
    else
      echo "[qBittorrent Init] Config file not found yet, will be created on first run"
      # Create initial config with RootFolder
      cat > "$CONFIG_FILE" << 'EOFCONFIG'
    [Preferences]
    WebUI\RootFolder=/qbittorrent
    EOFCONFIG
      echo "[qBittorrent Init] Created initial config with RootFolder=/qbittorrent"
    fi
