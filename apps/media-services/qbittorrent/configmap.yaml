apiVersion: v1
kind: ConfigMap
metadata:
  name: qbittorrent-init-scripts
  namespace: qbittorrent
data:
  10-set-webui-rootfolder.sh: |
    #!/usr/bin/with-contenv bash
    CONFIG_FILE="/config/qBittorrent/qBittorrent.conf"
    
    echo "[qBittorrent Init] Setting WebUI RootFolder..."
    
    # Create config directory if it doesn't exist
    mkdir -p /config/qBittorrent
    
    # If config file exists, update it
    if [ -f "$CONFIG_FILE" ]; then
      echo "[qBittorrent Init] Config file found, updating RootFolder..."
      # Remove existing RootFolder if present
      sed -i '/WebUI\\RootFolder/d' "$CONFIG_FILE"
      # Add RootFolder under [Preferences] section
      # Remove RootFolder setting - not needed for subdomain routing
      # RootFolder is only needed for path-based routing (e.g., /qbittorrent)
      # Since we use subdomain (qbittorrent.home.brettswift.com), no RootFolder needed
      echo "[qBittorrent Init] RootFolder removed (using subdomain routing)"
    else
      echo "[qBittorrent Init] Config file not found yet, will be created on first run"
      # No RootFolder needed for subdomain routing
    fi
